pipeline{
    agent any
    tools{
        maven 'maven'
    }
    environment {
    JAR_NAME = 'tictactoe-1.0-SNAPSHOT.jar'  // JAR name
    DEPLOY_DIR = '/opt/tictactoe'            // Deployment directory
}
        stages{
            stage('checkout')
            {
                steps{
               git branch:'master' url: 'https://github.com/ashutosh07766/tictactoe.git'
                }
            }
            stage('build')
            {
                steps{
                    sh 'mvn clean package'
                }
            }
            stage('test')
            {
                steps{
                    sh 'mvn test'
                }
            }
            stage('RUN JAR')
            {
                steps{
                    script{
                      sh "java -jar target/${JAR_NAME} &"
                      echo 'JAR IS RUNNING'
                    }
                }
            }
            stage('deploy')
            {
                steps{
                    script{
                        echo "Deploying the JAR..."

                    // Create deploy directory if it doesn't exist
                    sh "mkdir -p ${DEPLOY_DIR}"

                    // Copy the JAR to the deploy directory
                    sh "cp target/${JAR_NAME} ${DEPLOY_DIR}/"

                    // Restart the service (example, customize as needed)
                    sh "pkill -f ${JAR_NAME} || true"  // Kill any existing process
                    sh "nohup java -jar ${DEPLOY_DIR}/${JAR_NAME} &"

                    echo "Deployment completed!"
                    }
                }

            }

        }
        

}